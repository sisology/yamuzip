<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">

<head>
    <th:block layout:fragment="userCss">
    </th:block>
    <style>


        .buttons {
            text-align: Right;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            margin-right: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }


        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #priceTag {
            margin-right: 12px;
        }

        .infoTab {
            margin-left: 15px;
        }

        .post-actions button {
            margin-right: 10px;
        }

        .post-content {
            margin-top: 10px;
        }


        hr {
            color: black;
            opacity: 100;
        }

        .price {
            color: #003363;
            font-size: 40px;
        }

        .priceBox {
            display: flex;
            justify-content: space-between;
        }

        .heart {
            font-size: 30px;
            color: red;
        }

        .order {
            font-size: 20px;
            color: white;
            width: 100%;
            height: 60px;
            border-color: white;
            border-radius: 20px;
            background-color: #003363;;
        }

        .orderBox {
            display: flex;

            justify-content: center;

        }

        .profileCard p {
            color: black;
        }

        .profile img {
            width: 100px;
            height: 100px;
        }

        .breadcrumb li a {
            color: #003363;
        }

        .cardImg {
            width: 200px;
            height: auto;
        }

        .choice {
            color: black;
            margin-right: 10px;
        }

        .reviewImg {
            width: 300px;
            height: 200px;
        }

        .infoRow {
            margin-top: -100px;
        }

        .empty-heart::before {
            content: "♡"; /* 빈 하트 */
        }

        .full-heart::before {
            content: "♥️"; /* 채워진 하트 */
        }

        .carousel-item img {
            width: 100%;
            height: 400px; /* 높이는 원하는 값으로 조정합니다. */
            object-fit: cover; /* 이미지를 컨테이너에 맞추기 위해 사용합니다. */
        }
    </style>
</head>

<body>
<div id="fh5co-wrapper">
    <div id="fh5co-page">
        <div id="fh5co-header">
            <th:block layout:fragment="headerFragment"></th:block>
        </div>


        <div layout:fragment="content">
            <div class="fh5co-hero" style="height: auto;">
                <!--                <div class="fh5co-overlay"></div>-->
                <section class="container-sm" style="padding-top: 150px;">

                    <!--여기부터 본인 페이지 코드 작성-->

                    <section class="py-5">
                        <p>조회수 : <span id="viewsCount" th:text="${serviceDetailList.views}"></span></p>

                        <div class="container px-4 px-lg-5 my-5">
                            <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">소 카테테고리 제목</a></li>
                                    <li class="breadcrumb-item active" aria-current="page"><a href="#"><b>소 카테고리 내용</b></a>
                                    </li>
                                </ol>
                            </nav>
                            <div class="row gx-4 gx-lg-5 align-items-center">
                                <div class="col-md-6">
                                    <div id="carouselExampleFade" class="carousel slide carousel-fade">
                                        <div class="carousel-inner">
                                            <div class="carousel-item active" th:each = "images:${serviceImages}">
                                                <img src="..." class="d-block w-100" alt="..." th:src="@{${images.imgUrl}}">
                                            </div>

                                        </div>
                                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                        </button>
                                    </div>

                                </div>
                                <div class="col-md-6">
                                    <div class="card shadow-sm" style="width: 100%; height: auto">
                                        <div class="card-body" style="width: 100%">

                                            <h1 class="infoTab display-5 mt-3"
                                                th:text="${serviceDetailList.serviceTitle}">서비스 이름
                                                어쩌구</h1>
                                            <p class="infoTab lead border-top"
                                               th:text="${serviceDetailList.serviceExplain}">서비스
                                                설명</p>
                                            <div class="infoTab cardText mb-3">
                                                <span class="badge bg-primary"
                                                      th:text="${serviceDetailList.category.categoryName}">카테고리</span>

                                            </div>
                                            <div class="priceBox fs-5 mb-5 display-5 ">
                                                <span id="like" class="btn heart empty-heart"></span>
                                                <span id="priceTag" class="price"
                                                      th:text="${serviceDetailList.servicePrice}"><b>31,600~</b></span>
                                            </div>
                                            <div class="orderBox">
                                                <button class="order btn-block" th:onclick="|location.href='/order?serviceCode=' + ${serviceDetailList.serviceCode}|">주문하기</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- 서비스 설명 탭 -->
                        <div class="row">
                            <div class="col-md-6">
                                <nav class="nav nav-tabs">
                                    <a class="nav-link active" aria-current="page" href="#serviceContext">서비스 설명</a>
                                    <a class="nav-link" href="#options">옵션 정보</a>
                                    <a class="nav-link" href="#reviews">리뷰</a>
                                    <a class="nav-link" href="#cs">문의</a>
                                </nav>
                            </div>
                            <div class="profileCard col-md-2">
                                <img th:src="${serviceDetailList.dobby.dobImage}" class="cardImg card-img-top p-3 img-thumbnail"
                                     alt="...">
                            </div>
                            <div class="profileCard col-md-4 border p-5 shadow-sm"
                            >
                                <div class="Card">
                                    <div class="card-body">
                                        <p class="card-text border-bottom " th:inline="text">
                                            <b>도비:</b> [[${serviceDetailList.dobby.dobNickName}]]</p>
                                        <p class="card-text border-bottom "><b>영업일</b> : 연중무휴</p>
                                        <p class="card-text border-bottom" th:inline="text"><b>지역</b> :
                                            [[${serviceDetailList.dobby.dobArea}]]</p>
                                        <p class="card-text font-weight-bold"
                                           th:text="${serviceDetailList.dobby.dobContent}"></p>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="infoRow row">
                            <h1>Info</h1>
                            <div class="col-md-6" id="serviceContext">
                                <p th:utext="${serviceDetailList.serviceContent}">🔥구매 전 필독사항🔥

                                    ✔️핸드메이드 특성상 눈,코,입,귀 등
                                    위치나 모양이 조금씩 다를 수 있습니다.

                                    ✔️색상은 보시는 화면에따라
                                    실제와 차이가 있을 수 있습니다.

                                    ✔️기종과 옵션을 정확하게 선택해주세요.
                                    (주문제작 상품으로 잘못 선택 시
                                    교환/환불이 어려울 수 있습니다)

                                    ✔️추가 커스터마이징 및 색상문의 등
                                    다른 요청사항이나 궁금하신점은 메시지 주세요.</p>
                                <hr>

                            </div>
                        </div>

                        <h1>Options</h1>
                        <div class="row">
                            <div class="col-md-6" id="options">
                                <div class="bg-body rounded shadow-sm">
                                    <h6 class="border-bottom pb-2 mb-0">옵션</h6>
                                    <div class="d-flex text-body-secondary pt-3">
                                        <svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="20"
                                             height="20" xmlns="http://www.w3.org/2000/svg" role="img"
                                             aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice"
                                             focusable="false"><title>Placeholder</title>
                                            <rect width="100%" height="100%" fill="#007bff"></rect>
                                            <text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text>
                                        </svg>
                                        <div class="pb-3 mb-0 small lh-sm border-bottom w-100">
                                            <label for="option">옵션 선택:</label>
                                            <select name="option" id="option" th:field="*{serviceOptions}">
                                                <!-- Thymeleaf 반복문을 통해 옵션 목록 표시 -->
                                                <option value="none">선택안함</option>
                                                <option th:each="opt : ${serviceOptions}" th:value="${opt.optionPrice}"
                                                        th:text="${opt.optionName} + ' - 추가 금액: ' + ${opt.optionPrice}"></option>
                                            </select>


                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <h1>Reviews</h1>
                        <div class="row">
                            <div class="col-md-2" id="reviews">
                                <img src="/images/main_icon1.png" class="reviewImg img-thumbnail rounded "
                                     alt="...">
                            </div>

                            <div class="col-md-3" th:each="reviews:${reviews}">
                                <p id="userName" th:text="${reviews.user.userNickname}">
                                    사용자1234
                                </p>
                                <p id="reviewDate" th:text="${reviews.reviewCreated}">
                                    2024-01-01
                                </p>
                                <p id="reviewRate" th:text="${reviews.reviewGrade}">
                                    ⭐️⭐️⭐️⭐️⭐️

                                </p>

                                <p id="reviewContext" th:text="${reviews.reviewContent}">
                                    내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용내용
                                </p>
                            </div>
                            <hr>
                        </div>
                        <div class="container">
                            <h1>CS</h1>
                            <div class="post-list" id="cs">
                                <div class="post-item" th:each="cs:${cs}">
                                    <div class="post-header">
                                        <span th:text="${cs.csCode}">번호: 1</span>
                                        <span>답변여부: 예</span>
                                        <div class="dropdown">
                                            <button th:text="${cs.csType}" class="btn btn-secondary dropdown-toggle"
                                                    type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                문의 유형
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#">서비스 상세 문의</a></li>
                                                <li><a class="dropdown-item" href="#">환불/취소 문의</a></li>
                                                <li><a class="dropdown-item" href="#">일정 문의</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="post-content">
                                        <p th:text="${cs.csContent}">내용: 상품 관련 문의입니다.</p>
                                    </div>
                                    <div class="post-footer">
                                        <span th:text="${cs.user.userNickname}">작성자: John Doe</span>
                                        <span th:text="${cs.csCreated}">등록일자: 2024-03-20</span>
                                        <button>답변 작성</button>
                                        <button>내 문의 바로가기</button>

                                    </div>
                                </div>


                            </div>
                        </div>

                    </section>
                </section>
            </div>


            <!--여기까지 본인 페이지 코드 작성-->
        </div>
    </div>
    <!-- content -->

</div>
<!-- page -->

<!-- wrapper -->

<th:block layout:fragment="userScript">
    <!--본인 페이지 js 작성-->
    <script>
         const urlParams = new URLSearchParams(window.location.search);
        const serviceCode = urlParams.get('serviceCode');
        console.log(serviceCode + " @@@@@@@")

        function fetchViewsCount(serviceCode) {
            fetch(`/service/serviceDetail/views?serviceCode=${serviceCode}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })

                .catch(error => {
                    console.error('Error fetching views count:', error);
                });
        }


        window.onload = function () {
            fetchViewsCount(serviceCode);
        };

    </script>
    <script>
        document.getElementById("like").addEventListener("click", function () {
            var likeButton = document.getElementById("like");
            if (likeButton.classList.contains("empty-heart")) {
                likeButton.classList.remove("empty-heart");
                likeButton.classList.add("full-heart");
            } else {
                likeButton.classList.remove("full-heart");
                likeButton.classList.add("empty-heart");
            }
        });

    </script>
    <script>
        document.getElementById("like").addEventListener("click", function () {
            var likeButton = document.getElementById("like");

            console.log(serviceCode + "@!#@!#@!#@")
            // 서비스가 찜되었는지 여부 확인
            var isLiked = likeButton.classList.contains("empty-heart");

            // 찜 토글
            if (isLiked) {
                // 서비스가 찜되어 있으면 찜을 해제하도록 요청
                unlikeService(serviceCode);
            } else {
                // 서비스가 찜되어 있지 않으면 찜을 추가하도록 요청
                likeService(serviceCode);
            }
        });

        // 찜 추가 요청 함수
        function likeService(serviceCode) {
            console.log(serviceCode)
            // 서버에 찜 추가 요청 보내기 (예: Ajax 요청)
            // fetch 또는 axios를 사용하여 서버로 POST 요청을 보낼 수 있습니다.
            fetch("/likeService?serviceCode=" + serviceCode, {
                method: "POST",
                body: JSON.stringify({serviceCode: serviceCode}),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
                // 응답 처리
                if (response.ok) {
                    // 성공적으로 처리되었을 때의 동작
                    likeButton.classList.remove("empty-heart");
                    likeButton.classList.add("full-heart");
                } else {
                    // 오류가 발생했을 때의 동작
                    console.error("Failed to like service.");
                }
            }).catch(error => {
                console.error("Error:", error);
            });
        }

        // 찜 삭제 요청 함수
        function unlikeService(serviceCode) {
            // 서버에 찜 삭제 요청 보내기 (예: Ajax 요청)
            // fetch 또는 axios를 사용하여 서버로 POST 요청을 보낼 수 있습니다.
            fetch("/unlikeService?serviceCode=" + serviceCode, {
                method: "POST",
                body: JSON.stringify({serviceCode: serviceCode}),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
                // 응답 처리
                if (response.ok) {
                    // 성공적으로 처리되었을 때의 동작
                    likeButton.classList.remove("full-heart");
                    likeButton.classList.add("empty-heart");
                } else {
                    // 오류가 발생했을 때의 동작
                    console.error("Failed to unlike service.");
                }
            }).catch(error => {
                console.error("Error:", error);
            });
        }

    </script>
    <!-- Main JS -->
    <script src="/js/main.js"></script>
    <!--    const carousel = new bootstrap.Carousel('#myCarousel')-->
</th:block>

</body>
</html>
